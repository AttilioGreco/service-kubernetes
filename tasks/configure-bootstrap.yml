---
- name: configure-bootstrap | create "{{ cluster_name }}-kube-apiserver.service.automium.consul" record in /etc/hosts for consul boostrap
  lineinfile:
    state: present
    path: /etc/hosts
    line: "{{ ansible_default_ipv4['address'] }} {{ cluster_name }}-kube-apiserver.service.automium.consul"
  when:
    - master == "true"

- name: configure-bootstrap | create kubeadm configurations
  template:
    src: templates/kubeadm/kubeadm.init.yml.j2
    dest: "/etc/kubernetes/kubeadm-conf.yml"
    
- name: configure-bootstrap | bootstrap first master
  command: >-
    kubeadm init phase
    --config /etc/kubernetes/kubeadm-config.yaml
    --upload-certs
  register: kubeadm_upload_cert